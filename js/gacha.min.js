var radios=document.querySelectorAll("input[type=radio][name=prize]");const gacha_type=localStorage.getItem("gacha_type");gacha_type&&(radios[parseInt(gacha_type)].checked=!0,0==gacha_type?localStorage.getItem("gacha_type")?document.getElementById("inputPrize1").value=localStorage.getItem("gacha_number"):localStorage.getItem("gacha_type").value=10:document.getElementById("ta_custom").value=localStorage.getItem("gacha_names"));const delay=e=>new Promise(t=>setTimeout(t,e)),confetti=(e,{count:t=100,x:a=50,y:o=50,randX:r=10,randY:n=10,speedX:i=0,speedY:l=-2,speedRandX:s=.5,speedRandY:d=.5,gravity:c=.01,size:p=10,sizeRand:u=5}={})=>{const m=document.createElement("div");m.classList.add("confetti");const g=[];for(let e=0;e<t;e++){const e=document.createElement("span"),t={dom:e,x:a+Math.random()*r*2-r,y:o+Math.random()*n*2-n,speedX:i+Math.random()*s*2-s,speedY:l+Math.random()*d*2-d,size:p+Math.random()*u*2-u};e.style.backgroundColor=`hsl(${360*Math.random()}deg, 80%, 60%)`,e.style.setProperty("--rx",2*Math.random()-1),e.style.setProperty("--ry",2*Math.random()-1),e.style.setProperty("--rz",2*Math.random()-1),e.style.setProperty("--rs",2*Math.random()+.5),g.push(t),m.appendChild(e)}const h=()=>{g.forEach((e,t)=>{e.y>100&&(g.splice(t,1),e.dom.remove()),e.dom.style.setProperty("--size",e.size),e.dom.style.left=e.x+"%",e.dom.style.top=e.y+"%",e.x+=e.speedX,e.y+=e.speedY,e.speedY+=c}),g.length?requestAnimationFrame(h):m.remove()};h(),e.insertAdjacentElement("beforeend",m)},addAnimClass=(e,t,a)=>{const o=e=>{e.classList.add(t),e.setAttribute("data-animate","")};"string"==typeof e?[...document.querySelectorAll(e)].forEach(o):o(e)};let prizeBall,$app,$machine,$handle,$balls,$title,$pointer,prize,balls=[],started=!1,$$jitters=[];const SPEED=1,getPrize=async()=>{const e=[{image:"https://starcraft.aengji.com/img/bj_high/깅예솔.jpg",title:"Bunny"},{image:"https://starcraft.aengji.com/img/bj_high/깅예솔.jpg",title:"Teddy Bear"},{image:"https://starcraft.aengji.com/img/bj_high/깅예솔.jpg",title:"Polar Bear"},{image:"https://starcraft.aengji.com/img/bj_high/깅예솔.jpg",title:"Polar Bear Bride"}];return await e[~~(e.length*Math.random())]},init=async()=>{($app=document.querySelector("#app")).classList.add("gotcha");$machine=document.querySelector(".machine-container"),$handle=document.querySelector(".machine-container .handle"),$balls=document.querySelector(".machine-container .balls"),$title=document.querySelector(".title-container .title"),$pointer=document.querySelector(".machine-container .pointer"),$machine.querySelector(".title").innerHTML=[..."랜덤 뽑기!"].map(e=>`<span>${e}</span>`).join(""),$machine.querySelector(".price").innerText="500원",createBalls(),gsap.set($machine,{y:"100vh"}),gsap.set($title,{y:"120vh"}),gsap.set($pointer,{opacity:0}),gsap.set(".prize-reward-container",{opacity:0}),setTimeout(prepare,500)},prepare=()=>{gsap.timeline().to($machine,{y:"0vh",ease:"none",duration:.6,onComplete(){$handle.style.cursor="pointer",$handle.addEventListener("click",start),balls.forEach(e=>{const t=gsap.timeline(),a=.05+.1*Math.random();t.to(e.dom,{y:-(10+10*Math.random()),ease:"power1.out",duration:a}).to(e.dom,{y:0,duration:a,ease:"power1.in"}),setTimeout(()=>{started||showHint()},2e3)})}})};var once=!1;const start=async()=>{if(once)return;if(radios[0].checked){localStorage.setItem("gacha_type",0),localStorage.setItem("gacha_number",document.getElementById("inputPrize1").value);var e=Math.floor(Math.random()*document.getElementById("inputPrize1").value)+1;document.querySelector(".prize-container .prize span").textContent=e,prize={title:e}}else{if(""==document.getElementById("ta_custom").value.trim())return void alert("뽑기 내용을 입력하세요.");var t=document.getElementById("ta_custom").value.split("\n");t=t.filter(e=>e),localStorage.setItem("gacha_type",1),localStorage.setItem("gacha_names",document.getElementById("ta_custom").value);e=Math.floor(Math.random()*t.length);if(document.querySelector(".prize-container .prize span").textContent=t[e],prize={title:t[e]},bj_names.includes(t[e]))document.querySelector(".prize-container .prize img").src="img/bj_high/"+t[e]+".jpg",document.querySelector(".prize-container .prize img").style.display="block",document.querySelector(".shadow").style.fontSize="72px";else if(t[e].length>1){var a=!1;for(var o of bj_names)if(o.includes(t[e])){t[e]=o,a=!0;break}if(a)document.querySelector(".prize-container .prize img").src="img/bj_high/"+t[e]+".jpg",document.querySelector(".prize-container .prize img").style.display="block",document.querySelector(".shadow").style.fontSize="72px";else{var r;if(t[e].includes("투혼"))r="투혼.jpg";else if(t[e].includes("폴리"))r="폴리.jpg";else if(t[e].includes("이클"))r="이클.jpg";else if(t[e].includes("캄성"))r="ukkz.png";else if(t[e].includes("우끼"))r="ukkz.png";else if(t[e].includes("학버드"))r="logo_hakvard.png";else if(t[e].includes("염석"))r="ysd.png";else if(t[e].includes("바스포드"))r="basford.png";else if(t[e].includes("CP")||t[e].includes("씨피"))r="cp.png";else if(t[e].includes("파이스트"))r="pist.png";else if(t[e].includes("철기"))r="cgj.png";else if(t[e].includes("NSU")||t[e].includes("nsu"))r="nsu.png";else if(t[e].includes("JSA")||t[e].includes("jsa"))r="jsa.png";else{if(!(t[e].includes("무친")||t[e].includes("MCU")||t[e].includes("mcu")))return;r="mcu.png"}document.querySelector(".prize-container .prize img").src="img/"+r,document.querySelector(".prize-container .prize img").style.display="block",document.querySelector(".shadow").style.fontSize="72px"}}}once=!0,$handle.style.cursor="default",started=!0,hideHint(),await(()=>new Promise(e=>{gsap.timeline().to($handle,{rotate:90,duration:.3,ease:"power1.in",async onComplete(){jitter(),await delay(2e3),await stopJittering(),e()}}).to($handle,{rotate:0,duration:1})}))(),await(()=>new Promise(e=>{const t=gsap.timeline();gsap.to(prizeBall.dom,{x:"-3vh",ease:"none",duration:.5,rotate:prizeBall.rotate+10}),gsap.to(balls[3].dom,{x:"1vh",y:"1vh",ease:"none",duration:.5,rotate:balls[3].rotate-5}),gsap.to(balls[4].dom,{x:"-1vh",y:"1vh",ease:"none",duration:.5,rotate:balls[4].rotate-5}),gsap.to(balls[5].dom,{x:"1vh",y:"1vh",ease:"none",duration:.5,rotate:balls[5].rotate-5}),t.to(prizeBall.dom,{y:"12vh",ease:"power1.in",duration:.5}).to(prizeBall.dom,{y:"23vh",ease:"power1.in",duration:.5}).to(prizeBall.dom,{y:"22vh",ease:"power1.out",duration:.2}).to(prizeBall.dom,{y:"23vh",ease:"power1.in",duration:.2}).to(prizeBall.dom,{y:"22.5vh",ease:"power1.out",duration:.1}).to(prizeBall.dom,{y:"23vh",ease:"power1.in",duration:.1,onComplete:e})}))(),prizeBall.dom.style.cursor="pointer";let n=!0;prizeBall.dom.addEventListener("click",()=>{prizeBall.dom.style.cursor="default",n=!1,hideHint(),pickup()},{once:!0}),await delay(2e3),n&&showHint2()},pickup=()=>{let{x:e,y:t}=prizeBall.dom.getBoundingClientRect();[e,t]=[e/window.innerHeight*100,t/window.innerHeight*100],document.querySelector(".prize-container .prize-ball-container").appendChild(prizeBall.dom);const a=prizeBall.rotate;prizeBall.x=0,prizeBall.y=0,prizeBall.rotate=0,addAnimClass(".game-layer","dim"),prizeBall.dom.style.left=0,prizeBall.dom.style.top=0,gsap.set(prizeBall.dom,{x:`${e}vh`,y:`${t}vh`,rotate:a,duration:1}),gsap.to(".prize-container .prize-ball-container",{x:"-4vh",y:"-4vh",duration:1}),gsap.timeline().to(prizeBall.dom,{x:"50vw",y:"50vh",scale:2,rotate:-180,duration:1}).to(prizeBall.dom,{duration:.1,scaleX:2.1,ease:"power1.inOut",scaleY:1.9}).to(prizeBall.dom,{duration:.1,ease:"power1.inOut",scaleX:1.9,scaleY:2.1}).to(prizeBall.dom,{duration:.1,ease:"power1.inOut",scaleX:2.1,scaleY:1.9}).to(prizeBall.dom,{duration:.1,ease:"power1.inOut",scaleX:1.9,scaleY:2.1}).to(prizeBall.dom,{duration:.1,ease:"power1.inOut",scaleX:2.1,scaleY:1.9}).to(prizeBall.dom,{duration:.1,ease:"power1.inOut",scaleX:1.9,scaleY:2.1}).to(prizeBall.dom,{duration:.5,ease:"power1.out",scaleX:2.6,scaleY:1.6}).to(prizeBall.dom,{duration:.1,ease:"power1.out",scaleX:1.6,scaleY:2.4,onComplete:pop}).to(prizeBall.dom,{duration:.1,ease:"power1.out",scaleX:2.1,scaleY:1.9}).to(prizeBall.dom,{duration:.1,ease:"power1.out",scaleX:2,scaleY:2})},pop=()=>{confetti($app,{speedY:0,speedRandY:1,speedRandX:.75,speedY:-.5,gravity:.02,y:50,randX:6,randY:6,size:8,sizeRand:4,count:128}),gsap.set(".prize-reward-container .prize",{scale:0}),gsap.to(".prize-reward-container",{opacity:1,duration:.3}),gsap.to(".prize-reward-container .prize",{scale:1,duration:.5,ease:"back.out"}),gsap.to(prizeBall.dom,{opacity:0}),gsap.set($title,{y:"-50vh"}),$title.children[0].innerHTML=`뽑기 결과는..<br>${prize.title}`,gsap.to($title,{delay:1,y:"5vh",duration:.6}),gsap.to($machine,{y:"100vh",duration:1,delay:1,onComplete(){$machine.remove()}})},showHint=()=>{gsap.set($pointer,{opacity:0}),gsap.to($title,{y:"80vh",duration:1,ease:"back.out"}),gsap.to($pointer,{opacity:1,duration:1,ease:"none"})},hideHint=()=>{gsap.to($title,{y:"120vh",duration:.6}),gsap.to($pointer,{opacity:0,duration:1})},showHint2=()=>{$title.children[0].innerHTML="클릭!",gsap.set($pointer,{x:"16vh",y:"3vh"}),gsap.to($title,{y:"80vh",duration:1,ease:"back.out"}),gsap.to($pointer,{opacity:1,duration:1,ease:"none"})},createBalls=()=>{let e=0;const t=(t,a,o=~~(360*Math.random()),r=~~(360*Math.random()))=>{const n=document.createElement("figure");n.classList.add("ball"),n.setAttribute("data-id",++e),n.style.setProperty("--size","8vh"),n.style.setProperty("--color1",`hsl(${r}deg, 80%, 70%)`),n.style.setProperty("--color2",`hsl(${r+20}deg, 50%, 90%)`),n.style.setProperty("--outline",`hsl(${r}deg, 50%, 55%)`),$balls.appendChild(n);const i=()=>{gsap.set(n,{css:{left:`calc(${t} * (100% - 8vh))`,top:`calc(${a} * (100% - 8vh))`,transform:`rotate(${o}deg)`}})},l={dom:n,get x(){return t},get y(){return a},get rotate(){return o},set x(e){t=e,i()},set y(e){a=e,i()},set rotate(e){o=e,i()},get size(){return 8}};return balls.push(l),i(),l};t(.5,.6),t(0,.68),t(.22,.65),t(.7,.63),t(.96,.66),t(.75,.79),t(.5,.8),prizeBall=t(.9,.81),t(0,.82),t(1,.9),t(.25,.85),t(.9,1),t(.4,1),t(.65,1),t(.09,1)},jitter=()=>{balls.forEach(({dom:e,rotate:t},a)=>{const o=gsap.timeline({repeat:-1,delay:.0613*-a});gsap.set(e,{y:0,rotateZ:t});const r=.1*Math.random()+.05;o.to(e,{y:-(6*Math.random()+2),rotateZ:t,duration:r,ease:RoughEase.ease.config({template:Power0.easeOut,strength:1,points:20,taper:"none",randomize:!0,clamp:!1})}).to(e,{y:0,rotateZ:t-10*Math.random()-5,duration:r}),$$jitters.push(o)});const e=gsap.timeline({repeat:-1});e.to(".machine-container",{x:2,duration:.1}).to(".machine-container",{x:0,duration:.1}),$$jitters.push(e)},stopJittering=async()=>{$$jitters.forEach(e=>e.pause()),balls.forEach(({dom:e,rotate:t},a)=>{gsap.to(e,{y:0,rotate:t,duration:.1})}),gsap.to(".machine-container",{x:0,duration:.1}),await delay(200)};init();